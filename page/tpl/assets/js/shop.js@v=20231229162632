let shop=(function(){let prices,countries,currencies,features,currency,images,seasons,promocode,env,dailyEmotes;let self={init:function(){self.readUrl();self.changeDurationListener();self.changeProductListener();self.changeCurrencyListener();self.changeCountryListener();self.visitCheckout();self.initLocalSelection();self.flashSaleClickListener();self.addSalePromocode();self.initInputListener();self.changeUserListener();self.initShoppingCartOverlay();self.listenAddItemToShoppingCart();self.removeItemFromShoppingCart();self.promoCodeListener();self.unsetRefListener();self.listenAgbInput();self.partnerHandler();},partnerHandler:function(){document.querySelectorAll('.partner-wrapper .main-wrapper').forEach(el=>{el.addEventListener('click',()=>{window.history.replaceState({},'',`${window.location.origin}/${window.LANG.lang}/shop?partner=${el.dataset.partner}#partners`);});});},readUrl:function(){$(function(){if(location.hash!==''){if(location.hash==='#credit'||location.hash==='#coins'){$('.article-33').click();return;}
const locationhash=location.hash.substring(1).split('-');if(locationhash.length===0){return;}
let $tab=$('ul > li > a.'+locationhash[0].toUpperCase());if($tab.length){$tab.tab('show');if(typeof locationhash[1]==='undefined'){$('.'+$tab.data('click')).click();return;}
$('#article-section').find('.article').each(function(index,a){if($(a).attr('data-item-name').replace(/ /g,'').toLowerCase()===locationhash[1].toLowerCase()){$(a).click();let isMobile=window.matchMedia("only screen and (max-width: 760px)").matches;if(isMobile){setTimeout(function(){document.querySelector('.selected-product').scrollIntoView({block:"start",behavior:"smooth"});},450);}}});}}});},initInputListener:function(){$(function(){$('[data-toggle="tooltip"]').tooltip();});let $input=$('#username-input');let $oldUser;$input.focusout(function(){if($input.val()!==''&&$input.val()!==$oldUser){$('#user-avatar').attr('src','/page/tpl/assets/images/loadava.svg').delay(200).fadeIn('fast');$('#username-input').addClass('avatar');$.post('/api/shop',{action:'avatar',user:$input.val()},function(data){$('#user-avatar').attr('src','https://laby.net/texture/profile/head/'+data.uuid+'.png?size=64');$('#user-avatar').data('uuid',data.uuid);$oldUser=$input.val();if(data.uuid===''||data.uuid==='606e2ff0-ed77-4842-9d6c-e1d3321c7838'){$input.css('border-color','red');}else{$input.css('border-color','green');$('.article-img-canvas').data('uuid',data.uuid);if($('.article-img-canvas').length){loadCanvas($('.article-img-canvas'));}}});}else if($input.val()===''){$('#username-input').removeClass('avatar');$('#user-avatar').hide();$input.css('border-color','initial');}});$input.keydown(function(event){const $keyCode=(event.keyCode?event.keyCode:event.which);if($keyCode===13){$input.trigger('focusout');}
$('.user-not-found').hide();$('.receiver_already_has_item').hide();$input.css('border-color','initial');});},changeUserListener:function(){$('#loggedUserData .changeUser').click(function(){$('#loggedUserData').fadeOut(200);$('#customUserData').delay(201).show('slide',{direction:'right'},350);$('#usernameInput').trigger('focusout');});},addSalePromocode:function(){const saleCode=document.getElementById('addSaleCode');if(!saleCode){return;}
saleCode.addEventListener('click',()=>{self.applyPromocode('LABYSALE');saleCode.disabled=true;});},changeCurrencyListener:function(){$('#currency-input').on('change',function(){const $currency=$(this).val();if(prices[$currency]!==undefined){document.cookie='currency=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';self.setCookie('currency',$currency,30);$('#regular-price-currency').html($currency);$('#item-sale-currency').html($currency);$('.popover-currency').html($currency);$('#cart-sum-currency').html($currency);$('.current-currency-btn').html($currency);self.setCurrency($currency);self.updateTotal();self.reloadCurrentItemData();$('.cart-price').each(function(){const price=prices[$currency][$(this).data('item')]['price_'+$(this).data('duration')];if(price!==undefined){$(this).html(price.toFixed(2));}});}});},changeCountryListener:function(){$('#country-input').on('change',function(){const $country=$(this).val();document.cookie='country=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';self.setCookie('country',$country,30);$('.localBtn img').attr('src','/page/tpl/assets/images/lang/'+$country.toLowerCase()+'.png');});},visitCheckout:function(){$(function(){$('[data-toggle="popover"]').popover();});$('.checkout-btn').on('click',function(){const $cartContent=$('.popover-body').html();if($cartContent.includes('<p class="no-items">'+LANG.shop.cart.no_items)){self.openPopover($('.cart-popover'),$('.cart-btn').find('i'));}else{location.href='/checkout';}});},listenAddItemToShoppingCart:function(){$('#username-input').on('keypress',function(e){if(e.which===13){self.addItemToShoppingCart(this);}});$('.add-cart-btn').on('click',function(){self.addItemToShoppingCart(this);});$(function(){const validator=$('#physicalGiftcardForm').validate({debug:true,rules:{addressname:{required:true},addressstreet:{required:true},addresszip:{required:true}},submitHandler:function(form){$('#giftcardModal').modal('hide');let adressData={action:'add-item',item_receiver:$('#username-input').val(),shop_item_id:$('#current-item').val(),item_value:$('#current-duration').val(),requireAddress:'true',name:$('#address-name').val(),street:$('#address-street').val(),addition:$('#address-addition').val(),zip:$('#address-zip').val(),city:$('#address-city').val(),region:$('#address-region').val(),country:$('#address-country').val(),mail:$('#address-mail').val()};self.addItemToShoppingCart(this,adressData);}});});},addItemToShoppingCart:function(e,stmt=undefined){const $addCartButton=$('.add-cart-btn');$addCartButton.prop('disabled',true);const itemCategory=$('.article-'+$('#current-item').val()).data('item-category');const itemId=parseInt($('#current-item').val());const itemValue=$('#current-duration').val();let itemPrice=typeof prices[currency][itemId]['price_'+itemValue]!='undefined'?prices[currency][itemId]['price_'+itemValue]:'0';if(itemId===33){itemPrice=(prices[currency][33]['price_0']*parseInt(itemValue)).toFixed(2);}
if(itemCategory==='GIFTCARD'&&itemValue==='1'&&stmt===undefined){$('#giftcardModal').modal('toggle');$addCartButton.prop('disabled',false);return false;}
if(stmt===undefined){stmt={action:'add-item',item_receiver:$('#username-input').val(),shop_item_id:itemId,item_value:itemValue};}
if(itemId===376){const specialValue=$('#nametag-input').val(),nameTagError=$('.claim-error-nametag');if(specialValue===''||specialValue.length>16){nameTagError.show();$addCartButton.prop('disabled',false);return false;}
nameTagError.hide();stmt['unique_value']=specialValue;}
$.post('/api/shop/cart',stmt,function(data){const cart=$('.cart-btn');const count=$('.cart-count');const item=$('.active-item').find('img').eq(0);if(data.message!==undefined){$addCartButton.prop('disabled',false);if(data.message==='user_not_found'){$('.user-not-found').show();$('.receiver_already_has_item').hide();$('#username-input').css('border-color','red');}else if(data.message==='receiver_already_has_item'){$('.receiver_already_has_item').show();$('.user-not-found').hide();}else if(data.message==='unique_user_not_found'){$('.claim-error-nametag').show();}else{self.openPopover($('.cart-popover'),$('.cart-btn').find('i'));setTimeout(function(){const $popover=$('.popover-message-error');$popover.html(LANG.shop.cart.error[data.message]);$popover.slideDown('fast');$addCartButton.prop('disabled',false);},100);}}else{const cartItemId=data.item.cart_item_id;$('.user-not-found').hide();$('.receiver_already_has_item').hide();if($('.article-'+$('#current-item').val()).data('item-category')!=='EMOTE'){const itemToMove=item.clone().offset({top:item.offset().top,left:item.offset().left}).css({'position':'absolute','width':50,'z-index':'100'}).appendTo($('body')).animate({'top':cart.offset().top,'left':cart.offset().left,'width':75},1000,'easeInOutExpo');itemToMove.animate({'top':cart.offset().top+100});itemToMove.fadeOut();}
setTimeout(function(){count.html(parseInt(count.html())+1);const content=$('.cart-item-information').html();const currentItem=$('.article-'+$('#current-item').val());const itemName=currentItem.data('item-name');let duration=$('#current-duration').val();const customDuration=parseFloat(currentItem.data('custom-duration'));let durationString='';if(duration==='custom'&&customDuration<1){durationString+=`${Math.round(customDuration*30.417)} ${LANG['general']['days']}`}else{duration=parseInt(duration);durationString+=duration>=1000?duration+' LabyCoins':duration===0&&itemCategory==='GIFTCARD'?LANG.shop.digital:duration===1&&itemCategory==='GIFTCARD'?LANG.shop.physical:duration===0?'Lifetime':duration===1?'1 '+LANG.shop.month:duration+' '+LANG.shop.months;}
let newItemImage;if(itemCategory==='EMOTE'){newItemImage=`<img src="https://skin.laby.net/api/render/user/${data.receiver.uuid}.png" alt="`+itemName+`">`;}else{newItemImage=`<img src="`+item.attr(`src`)+`" alt="`+itemName+`">`;}
let saleString='';if($(`.item-sale`).is(":visible")){saleString=`<br><span class="sale-save">${$(`#item-sale-value`).text()} ${$(`#item-sale-currency`).text()}</span>`;}
const receiver=data.receiver.name===null?'':data.receiver.name;const newItemContent=`<tr><td class="item-img">`+newItemImage+`</td><td><span class="item-name">`+itemName+`</span><span class="item-value">`+durationString+
`</span><span class="item-receiver">`+receiver+
`</span></td><td class="price"><span class="price-value cart-price" data-duration="`+duration+`" data-item="`+$(`#current-item`).val()+
`">`+$(`#regular-price-value`).html()+`</span> <span class="popover-currency">`+$(`#regular-price-currency`).html()+
`</span>`+saleString+`</td><td class="remove-item" data-shop-item-id="`+itemId+`" data-item-value="`+duration+`" data-item-name="`+itemName+`" data-item="`+cartItemId+`"><i class="fas fa-times"></i></td></tr>`;$('.no-items').hide();$('.checkout-btn').removeAttr('disabled');$('.cart-item-information').html(content+newItemContent);const lastElement=$('.cart-item-information tr:last-of-type');lastElement.find('td').wrapInner('<div style="display: none;" />');lastElement.hide();self.updateTotal();self.updatePromocode(promocode);self.openPopover($('.cart-popover'),$('.cart-btn').find('i'));dataLayer.push({'event':'add_to_cart','ecommerce':{'items':[{'item_name':itemName,'item_id':itemId,'price':itemPrice.toString(),'item_category':itemCategory,'item_variant':itemValue,}]}});console.debug({'event':'add_to_cart','ecommerce':{'items':[{'item_name':itemName,'item_id':itemId,'price':itemPrice.toString(),'item_category':itemCategory,'item_variant':itemValue,}]}});setTimeout(function(){$('.popover-message-error').hide();lastElement.fadeIn(500);lastElement.parent().find('td > div').slideDown(500,function(){const $set=$(this);$set.replaceWith($set.contents());});setTimeout(function(){$('.popover-message-success').slideDown('fast');$addCartButton.prop('disabled',false);},100);},800);},300);}}).fail(response=>{console.log('Error: '+response.responseText);$addCartButton.prop('disabled',false);});},removeItemFromShoppingCart:function(){$('.remove-item').live('click',function(){const cartItemId=$(this).data('item');const itemId=$(this).data('shop-item-id');const itemName=$(this).data('item-name');const itemValue=$(this).data('item-value');let stmt={action:'remove-item',cart_item_id:cartItemId};const $t=$(this);$.post('/api/shop/cart',stmt,function(data){if(data.message!=='item_removed'){setTimeout(function(){$('.popover-message-error').html(LANG.shop.cart.error[data.message]);$('.popover-message-error').slideDown('fast');},100);}else{$('.no-items').hide();$('.checkout-btn').removeAttr('disabled');$t.hide();const $count=$('.cart-count');$count.html(parseInt($count.html())-1);$t.parent().toggle(300);$t.parent().find('td').wrapInner('<div style="display: block;" />').parent().find('td > div').slideUp(300,function(){$(this).parent().parent().remove();});self.updateTotal();self.updatePromocode(promocode);dataLayer.push({'event':'remove_from_cart','ecommerce':{'items':[{'item_name':itemName,'item_id':itemId,'item_variant':itemValue,}]}});console.debug({'event':'remove_from_cart','ecommerce':{'items':[{'item_name':itemName,'item_id':itemId,'item_variant':itemValue,}]}});}});});},changeDurationListener:function(){$('input.creditInput[type=text]').blur(function(){$('#regular-price-value').html(self.fixPrice(prices[currency][33]['price_0']*parseInt($(this).val().replace('.',''))));});$('input[type=radio]').change(function(){const item=$('#current-item').val();const duration=$(this).val();$('#current-duration').val(duration);if($('.article-'+item).data('item-category')!=='GIFTCARD'){if(prices[currency][item]['sale']===true){$('.item-sale').show();const sale=prices[currency][item]['price_'+duration+'_old'].toFixed(2);$('#item-sale-value').html(sale);}else if(parseInt(item)===153&&parseInt(duration)===6&&prices[currency][item]['price_'+duration]!==23.99){$('.item-sale').show();$('#item-sale-value').html(23.99.toFixed(2));}else if(parseInt(item)===153&&parseInt(duration)===12&&prices[currency][item]['price_'+duration]!==39.99){$('.item-sale').show();$('#item-sale-value').html(39.99.toFixed(2));}else{$('.item-sale').hide();}
if(prices['EUR'][item]['price_'+duration]!==null){const coinTemplate=prices['EUR'][item]['price_'+duration].toString().includes('.')?prices['EUR'][item]['price_'+duration]:prices['EUR'][item]['price_'+duration]+'.00';const $shortCoins=parseFloat(coinTemplate).toFixed(2);const $coins=$shortCoins.toString().replace('.','\'')+'0';$('.coin-price-value').html($coins);$('#regular-price-value').html(prices[currency][item]['price_'+duration].toFixed(2));}}});},changeProductListener:function(){self.updatePromocode(promocode);$('.remove-partner').on('click',function(){if(window.location.href.includes('?partner')){const url=new URL(window.location.href);url.searchParams.delete("partner");window.history.replaceState({},'',url.toString());}})
$('.nav-tabs a').on('click',function(){$('.active-item').removeClass('active-item');$('.'+$(this).data('click')).click();if($(this)[0].getAttribute('href')!==undefined){location.hash=$(this)[0].getAttribute('href');}
if($(this).hasClass('featured')||$(this).hasClass('EMOTE')){$('#renderoverlay').show();}else{$('#renderoverlay').hide();}});$('.article').on('click',function(){if($(this).data('on-preview')===true){return false;}
$('.receiver_already_has_item').hide();$('.first-duration').removeClass('first-duration');$('.single-duration').removeClass('single-duration');$('.last-duration').removeClass('last-duration');$('.article').removeClass('active-item');$(this).addClass('active-item');const itemId=parseInt($(this).data('shop-item-id'));const img=$(this).find('img').eq(0).attr('src');const customDuration=parseFloat($(this).data('custom-duration'));if(customDuration!==0.00){$('#custom-days').html(Math.round(customDuration*30.417));}
const itemCategory=$(this).data('item-category');const itemName=$(this).data('item-name');$('.product-details').attr('class','product-details pull-right');$('.product-details').addClass(itemCategory);const nameTagSection=$('#nametag-section');itemId===376?nameTagSection.show():nameTagSection.hide();if(itemCategory==='EMOTE'&&$(this).find('.emotecanvas').attr('emote-data')){$('.article-image-carousel').hide();var uuid='34e57efa-5783-46c7-a9fc-890296aaba1f';if(($('#user-avatar').data('uuid')!=undefined)&&($('#user-avatar').data('uuid')!='606e2ff0-ed77-4842-9d6c-e1d3321c7838')){uuid=$('#user-avatar').data('uuid');}else if(USER!=null&&typeof USER.uuid!=='undefined'){uuid=USER.uuid;}
var emoteData=$(this).find('.emotecanvas').attr('emote-data');if(emoteData){emoteData=emoteData.toString();$('.article-img-canvas').data('uuid',uuid).attr('emote-data',emoteData);$('.article-img-canvas').show();loadCanvas($('.article-img-canvas'));}}else if(img===undefined){$('.article-image-carousel').hide();$('.article-img-canvas').hide();}else{$('.article-img-canvas').hide();const $path='/images/products/';const imgName=img.replace($path,'');const isSeasonImg=!imgName.split('.').reverse()[1].endsWith('_0');let curimage=images[itemId].filter(detailImage=>{let suffix=detailImage.split('.').reverse()[1].split('_').reverse()[0];if(isSeasonImg){return suffix!=='0';}else if(seasons.length>0){return!seasons.includes(suffix);}
return true;});let $carouselInner=$('#article-image-carousel > .carousel-inner');$carouselInner.html('');if(curimage!==undefined){if(curimage.includes(imgName)){let seasonImg=curimage.splice(curimage.indexOf(imgName),1)[0];curimage.unshift(seasonImg);}
for(let i=0;i<curimage.length;i++){const active=i===0?'active':'';$carouselInner.append('<div class="item '+active+'"><img src="'+$path+curimage[i]+'" draggable="false"></div>');}}
let $carouselControl=$('#article-image-carousel > .carousel-control');if(curimage!==undefined){if(curimage.length===1){$carouselControl.hide();}else{$carouselControl.show();}
$('.article-image-carousel').show();}}
let featureList='';let json=features;if(!$(this).data('bundle-items')&&$(this).data('item-category')!=='BUNDLE'){for(let i=0;i<json.length;i++){const obj=json[i];if(parseInt(obj.shop_item_id)===itemId&&parseInt(obj.description)===0){featureList+='<div class="product-feature"><i class="fa fa-check"></i> '+LANG.shop_features[obj.item_feature]+'</div>';}}}else{let items=$(this).data('bundle-items');if(!items){const itemArray=document.getElementsByClassName(`article-${$(this).data('shop-item-id')}`);items=itemArray[itemArray.length-1].dataset.bundleItems;}
if(items){let features=items.split(';');for(let i=0;i<features.length;i++){const feature=features[i].split(':');featureList+='<div class="product-feature '+feature[0]+'"><i class="fa fa-check"></i> '+feature[1]+' '+feature[0]+'</div>';}}}
const dependencyName=$(this).data('dependency-name');document.querySelector('#depending .item-name').innerText=$(this).data('item-name');document.querySelector('#depending .depending-item-name').innerText=dependencyName;document.getElementById('depending').style.display=(dependencyName?'inherit':'none');if(itemId===157){for(let key in dailyEmotes){if(dailyEmotes.hasOwnProperty(key)){featureList+='<div class="product-feature"><i class="fa fa-check"></i> '+dailyEmotes[key].item_name+'</div>';}}}
$('.product-features').html(featureList);let createName=$(this).data('creator-name');$('.product-creator').html(createName!==undefined?`Creator: <b>${createName}</b>`:'');let description='';for(let i=0;i<json.length;i++){const obj=json[i];if(parseInt(obj.shop_item_id)===itemId&&parseInt(obj.description)===1&&LANG.shop_features[obj.item_feature]!==undefined){description+='<div class="description">'+LANG.shop_features[obj.item_feature]+'</div>';}}
if(description!==undefined){$('.product-description').html(description);}
$('#current-item').val(itemId);const durationNumber=prices[currency][itemId]['price_1']?'1':prices[currency][itemId]['price_3']?'3':prices[currency][itemId]['price_6']?'6':prices[currency][itemId]['price_12']?'12':prices[currency][itemId]['price_0']?'0':prices[currency][itemId]['price_custom']?'custom':'Error';if(itemId===33){$('#current-duration').val('10000');$('#creditInput').val('10.000');}else{$('#current-duration').val(durationNumber);}
const $getPrice=typeof prices[currency][itemId]['price_'+durationNumber]!='undefined'?prices[currency][itemId]['price_'+durationNumber]:'0';const $getEURPrice=typeof prices['EUR'][itemId]['price_'+durationNumber]!='undefined'?prices['EUR'][itemId]['price_'+durationNumber]:'0';const $coinTemplate=$getEURPrice.toString().includes('.')?$getEURPrice:$getEURPrice+'.00';const $shortCoins=parseFloat($coinTemplate).toFixed(2);const $getCoins=$shortCoins.toString().replace('.','\'')+'0';let priceArray=['price_1','price_3','price_6','price_12','price_0','price_custom'];let i,len,duration,lastValue,count;$('#price_'+durationNumber).prop('checked',true);const availablePrices=[];for(count=0,i=0,len=priceArray.length,duration='';i<len;i++){if(prices[currency][itemId][priceArray[i]]!==null){availablePrices.push(priceArray[i]);count++;lastValue=priceArray[i];}}
if(availablePrices[2]!==undefined){$('.price_'+durationNumber).addClass('first-duration');$('.'+availablePrices[2]).addClass('last-duration');if(count>2){for(count=0,i=0,len=availablePrices.length;i<len;i++){if(i>2){$('.'+priceArray[i]).addClass('single-duration');}}}}else{$('.price_'+durationNumber).addClass('single-duration');}
if(parseInt($(this).data('coin-payment'))){$('.coin-price').show();}else{$('.coin-price').hide();}
if(itemCategory!=='GIFTCARD'&&parseInt($(this).data('shop-item-id'))!==33&&$(this).data('item-detail-cat')!=='COINS'){$('.normal-duration').show();$('.duration').show();$('.username-section').show();$('.giftcard-type').hide();$('.coin-type').hide();for(i=0,len=priceArray.length,duration='';i<len;i++){if(prices[currency][itemId][priceArray[i]]!==null){$('.'+priceArray[i]).show();}else{$('.'+priceArray[i]).hide();}}}else if(parseInt($(this).data('shop-item-id'))===33){$('.coin-type').show();$('.username-section').show();$('.giftcard-type').hide();$('.duration').hide();$('.normal-duration').hide();}else if($(this).data('item-category')==='bundle'&&$(this).data('item-detail-cat')==='COINS'){$('.coin-type').hide();$('.username-section').show();$('.giftcard-type').hide();$('.duration').hide();$('.normal-duration').hide();}else{$('.giftcard-type').show();$('.duration').show();$('.giftcard-item').show();$('.normal-duration').hide();$('.username-section').hide();$('.coin-type').hide();$('.giftcard-first').click();$('.giftcard-item').addClass('single-duration');}
if(itemId===33){$('.item-sale').hide();$('#regular-price-value').html(self.fixPrice(prices[currency][33]['price_0']*10000));}else if(prices[currency][itemId]['sale']===true){$('.item-sale').show();$('#regular-price-value').html($getPrice.toFixed(2));$('#item-sale-value').html(prices[currency][itemId]['price_'+durationNumber+'_old'].toFixed(2));}else if(itemId===153&&durationNumber===6&&parseFloat($getPrice)!==23.99){$('#regular-price-value').html(parseFloat($getPrice).toFixed(2));$('.item-sale').show();$('#item-sale-value').html(23.99.toFixed(2));}else if(itemId===153&&durationNumber===12&&parseFloat($getPrice)!==39.99){$('#regular-price-value').html(parseFloat($getPrice).toFixed(2));$('.item-sale').show();$('#item-sale-value').html(39.99.toFixed(2));}else{$('#regular-price-value').html(parseFloat($getPrice).toFixed(2));$('.item-sale').hide();}
$('.coin-price-value').html($getCoins);$('.product-name').html(itemName);$('.item-badge').html(itemCategory);dataLayer.push({'event':'select_item','ecommerce':{'items':[{'item_name':itemName,'item_id':itemId,'item_category':itemCategory,'quantity':1,'price':$getPrice.toFixed(2)}]}});});},updatePriceList:function(){$.post('/api/shop',{action:'get-prices'},function(data){self.setPrices(data.prices);self.updateTotal();});},updateTotal:function(){$.post('/api/shop/cart',{action:'get-info'},function(data){document.dispatchEvent(new CustomEvent('shop-cart-change',{detail:{info:data}}));const saleWrapper=document.getElementById('saved-due-sale');if(saleWrapper){let saleDiscount=0;data.cart.items.forEach(el=>{if(el.sale!==null){saleDiscount+=el.original_price[currency]-el.price[currency];}});saleWrapper.innerHTML=self.fixPrice(saleDiscount);}
$('#cart-sum-price').html(self.fixPrice(data.cart.price[currency]));if(self.fixPrice(data.cart.price[currency])==='0.00'){$('.no-items').show();$('.checkout-btn').prop('disabled',true);}});},fixPrice:function(price){if(price!==undefined){let rtPrice=price;if(!price.toString().includes('.')){rtPrice=rtPrice+'.00';}
let sp=rtPrice.toString().split('.');if(sp[1].length===1){rtPrice=rtPrice+'0';}
return parseFloat(rtPrice).toFixed(2);}else{return null;}},flashSaleClickListener:function(){$('.flash-sale-wrapper').on("click",function(){var product=$(this).data("product");var $c=$('.article-'+product).first();$c.click();});},setPrices:function(p){prices=p;},setCountries:function(c){countries=c;},setCurrencies:function(c){currencies=c;},setImages:function(i){images=i;},setSeasons:function(s){seasons=s;},setCurrency:function(c){currency=c;},setFeatures:function(f){features=f;},setPromocode:function(p){promocode=p;},setEnviroment:function(e){env=e;},setDailyEmotes:function(e){dailyEmotes=e;},initShoppingCartOverlay:function(){$('.cart-popover-overlay, .close-mobile-btn').on('click',function(){self.closePopover($('.cart-popover'));});$('.cart-btn').on('click',function(){self.openPopover($('.cart-popover'),$(this).find('i'));});},openPopover:function(el,btn){if(!el.hasClass('open')){el.addClass('open');$('.cart-popover-overlay').fadeIn('fast');el.animate({opacity:'1',height:'toggle'},'slow');$('body').addClass('popover-open');}
if($(window).width()>768){el.position({my:'center bottom',at:'center top+50',of:btn,collision:'none'});}},closePopover:function(el){if(el.hasClass('open')){$('body').removeClass('popover-open');el.removeClass('open');$('.cart-popover-overlay').fadeOut('fast');el.animate({opacity:'0',height:'toggle'},'600','swing');el.find('.popover-message-error').hide();el.find('.popover-message').hide();}},initLocalSelection:function(){$('.localBtn').on('click',function(){self.openPopover($('.local-popover'),$(this));});$('.cart-popover-overlay').on('click',function(){self.closePopover($('.local-popover'));});},unsetRefListener:function(){$('.remove-referral').on('click',function(e){document.cookie='ref=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';$('#ref').val('');window.location='/shop';});},applyPromocode:function(inputValue){return new Promise(function(){$.ajax({method:'POST',url:'/api/shop/cart',data:{action:'add-promocode',code:inputValue},success:function(data){const $code=$('.enterCodeBtn');if(data.message==='added'){if(data['promo_code']){$code.html('<i class="fa fa-gift" aria-hidden="true"></i> '+data.promo_code.name+' <span class="delete-button" title="'+LANG.general.remove+'"><i class="fas fa-times"></i></span>');$code.addClass('remove-promocode');$code.removeClass('enterCodeBtn');$('.checkout-btn').removeAttr('disabled');const price=parseFloat($('#regular-price-value').html());const totalPrice=parseFloat($('#cart-sum-price').html())+price;$('#cart-sum-price').html(totalPrice.toFixed(2));self.setPromocode(data.promo_code);self.updatePromocode(promocode);}else if(data['ref']){$('.remove-referral').remove();$code.html('<i class="fa fa-smile" aria-hidden="true"></i> Referral: '+data.ref.user_name+' <span class="delete-button" title="'+LANG.general.remove+'"><i class="fas fa-times"></i></span>');$code.addClass('remove-promocode');$code.removeClass('enterCodeBtn');let codeinfo={'code':data.ref.user_name};self.setPromocode(codeinfo);self.updatePromocode(promocode);}
Swal.close();}else if(data['message']==='free_code'){window.location='/redeem/'+inputValue;Swal.close();}else{Swal.showValidationMessage(LANG.shop.promocode[data['message']]?LANG.shop.promocode[data['message']]:'undefined_error');swal.enableButtons();}},error:function(data){Swal.showValidationMessage(data['responseText']);}}).fail(function(response){console.log('Error: '+response.responseText);});});},promoCodeListener:function(){if(window.location.href.indexOf('discountCode')>-1){console.debug('discountCode found in URL');const url=new URL(window.location.href);console.debug('discountCode: '+url.searchParams.get('discountCode'));const code=url.searchParams.get('discountCode');self.applyPromocode(code);}
$('.enterCodeBtn').on('click',function(){Swal.fire({title:LANG.shop.promocode_modal.title,input:'text',inputAttributes:{autocapitalize:'off'},confirmButtonText:LANG.shop.promocode_modal.btn_redeem,cancelButtonText:LANG.general['cancel'],showLoaderOnConfirm:false,showConfirmButton:true,showCancelButton:true,closeOnConfirm:false,customClass:'promocode-input',preConfirm:(inputValue)=>{return self.applyPromocode(inputValue);}});});$('.remove-promocode').live('click',function(){$.post('/api/shop/cart',{action:'remove-promocode'},function(){$(this).remove();$('.remove-referral').addClass('enterCodeBtn');$('.remove-referral').removeClass('remove-referral');$('.enterCodeBtn').html('<i class="fa fa-gift" aria-hidden="true"></i> Promo Code');$('.promocode-popover').html('');self.setPromocode(null);self.updatePromocode(promocode);self.updatePriceList();const $del=$('.remove-promocode');$del.addClass('enterCodeBtn');$del.removeClass('badge-promocode badge text-uppercase remove-promocode');$del.html('<i class="fa fa-gift" aria-hidden="true"></i> Promo Code');$('#addSaleCode').prop('disabled',false);});});},reloadCurrentItemData:function(){const $c=$('.article-'+$('#current-item').val());$c.click();$c.addClass('active-item');},updatePromocode:function(code){if(env==='shop'){$.post('/api/shop/cart',{action:'get-info'},function(data){$('#cart-sum-price').html(self.fixPrice(data.cart.price[currency]));if(code!==null){$('.popover-footer .row').css('height','70px');$('.promocode-popover').html('<div class="col-md-2 item-img"><i class="fa fa-gift" aria-hidden="true"></i></div>'+
'<div class="col-md-5"><span class="item-name">'+code.code+'</span>'+
'</div><div class="col-md-4 price"><span class="price-value cart-price cart-promo-price">- '+self.fixPrice(data.cart.promocode_saving[currency])+
'</span> <span class="popover-currency">'+currency+'</span></div><div class="col-md-1 remove-promocode"><i class="fas fa-times"></i></div>');}else{$('.promocode-popover').html('');$('.popover-footer .row').css('height','auto');}});}},listenAgbInput:function(){$('#agbSection input[type=checkbox]').on('change',function(){$(this).removeClass('error');});},setCookie:function(cname,cvalue,exdays){var d=new Date();d.setTime(d.getTime()+(exdays*24*60*60*1000));var expires='expires='+d.toUTCString();document.cookie=cname+'='+cvalue+';'+expires+';path=/';}};return{init:self.init,setPrices:self.setPrices,setCurrencies:self.setCurrencies,setCountries:self.setCountries,setImages:self.setImages,setSeasons:self.setSeasons,setCurrency:self.setCurrency,setFeatures:self.setFeatures,setPromocode:self.setPromocode,setEnviroment:self.setEnviroment,setDailyEmotes:self.setDailyEmotes};})
();$(function(){shop.init();$('#shoploading').hide();$('#order').show();$('.article:first').click();$('.article:first').addClass('active-item');});